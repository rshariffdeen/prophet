<!DOCTYPE html><html><head><meta charset="utf-8"><title>1. Replication Package Overview.md</title><style></style></head><body id="preview">
<h1 class="code-line" data-line-start=0 data-line-end=1 ><a id="1_Replication_Package_Overview_0"></a>1. Replication Package Overview</h1>
<p class="has-line-data" data-line-start="2" data-line-end="7">This replication package contains the necessary files to reproduce the results<br>
of the POPL paper ``Automatic Patch Generation by Learning Correct Code’’.<br>
Our paper presents Prophet, a novel patch generation system that uses the staged<br>
condition synthesis technique. The replication package provides a way to reproduce<br>
all of our experiments with Prophet.</p>
<p class="has-line-data" data-line-start="8" data-line-end="15">The original replication package relies on Amazon EC2 images to reproduce the<br>
exact execution environment of the experiments. Although it gives 100%<br>
replication, it is not as conveniant as VM images. Now the instance types we<br>
used to run our experiments are no longer provided by Amazon. We decide to<br>
rebuild the replication package with VMWare VMs. Therefore, it is worth noting<br>
that the running time you obtain with the VM runs will be <em>different</em> from the<br>
time originally mentioned in the paper.</p>
<p class="has-line-data" data-line-start="16" data-line-end="17">The package contains the following components:</p>
<ol>
<li class="has-line-data" data-line-start="18" data-line-end="21">
<p class="has-line-data" data-line-start="18" data-line-end="20">A public VM image for reproducing all of our experiments except fbc.<br>
<a href="http://www.cs.toronto.edu/~fanl/program_repair/vm/Ubuntu-prophet-64-bit.tar.gz">http://www.cs.toronto.edu/~fanl/program_repair/vm/Ubuntu-prophet-64-bit.tar.gz</a></p>
</li>
<li class="has-line-data" data-line-start="21" data-line-end="24">
<p class="has-line-data" data-line-start="21" data-line-end="23">A public VM image for reproducing the remaining fbc experiments<br>
<a href="http://www.cs.toronto.edu/~fanl/program_repair/vm/Ubuntu-14.04.1-32bit.tar.gz">http://www.cs.toronto.edu/~fanl/program_repair/vm/Ubuntu-14.04.1-32bit.tar.gz</a></p>
</li>
<li class="has-line-data" data-line-start="24" data-line-end="29">
<p class="has-line-data" data-line-start="24" data-line-end="26">Scenario tarballs that contain necessary files to reproduce each of the defects<br>
in our experiments.</p>
<p class="has-line-data" data-line-start="27" data-line-end="28"><a href="http://www.cs.toronto.edu/~fanl/program_repair/scenarios/">http://www.cs.toronto.edu/~fanl/program_repair/scenarios/</a></p>
</li>
<li class="has-line-data" data-line-start="29" data-line-end="33">
<p class="has-line-data" data-line-start="29" data-line-end="30">Prophet generated patches for the benchmark defects:</p>
<p class="has-line-data" data-line-start="31" data-line-end="32"><a href="http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/">http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/</a></p>
</li>
</ol>
<p class="has-line-data" data-line-start="33" data-line-end="34">Note that all Prophet source code in the VM image of the replication package is licensed under GPLv3.</p>
<h2 class="code-line" data-line-start=35 data-line-end=36 ><a id="11_Consistency_and_Completeness_35"></a>1.1 Consistency and Completeness</h2>
<p class="has-line-data" data-line-start="37" data-line-end="41">A user can use the replication package to reproduce all of our Prophet experiments<br>
we performed in the paper. Specifically, the replication package is able to<br>
reproduce all results in Figure 10, Figure 11, and Figure 12 in the paper.<br>
Note that the results of GenProg and AE are obtained from previous work.</p>
<p class="has-line-data" data-line-start="42" data-line-end="46">The results obtained from the replication package will be in general consistent<br>
with the reported results in the paper. For each defect for which we<br>
claim, in the paper, that Prophet generates a plausible or correct patch,<br>
the user can use the replication package to obtain the same patch.</p>
<h2 class="code-line" data-line-start=47 data-line-end=48 ><a id="12_Ease_of_Reuse_47"></a>1.2 Ease of Reuse</h2>
<p class="has-line-data" data-line-start="49" data-line-end="56">Program defects often require specific environment setup to reproduce. To<br>
facilitate the reproduction we packed our systems into VM images and our<br>
benchmark defects into scenario tarballs. We also provide script to facilitate<br>
the generation of every number in Figure 10, Figure 11, and Figure 12. Note that our<br>
experiments include manual analysis of the generated patches to identify<br>
whether the patch is correct or not. We provide descriptions for each Prophet<br>
generated correct patches.</p>
<h2 class="code-line" data-line-start=57 data-line-end=58 ><a id="13_Potential_to_Facilitate_Future_Research_57"></a>1.3 Potential to Facilitate Future Research</h2>
<p class="has-line-data" data-line-start="59" data-line-end="64">One benefit to the future research is that Prophet in this replication package can<br>
be used as the baseline system for the future research. As all the source code<br>
of Prophet is available inside the provided VM images, researcher who want to build<br>
new patch generation systems can build their systems on top of Prophet and reuse<br>
(part of) the Prophet source code.</p>
<p class="has-line-data" data-line-start="65" data-line-end="70">Another benefit to the future research in the field is that the benchmark<br>
scenario tarballs in the replication package provide useful infrastructures<br>
(test cases and scripts) to evaluate future patch generation systems. Note that<br>
Prophet is evaluated on the GenProg 2012 benchmark set and we fixed several<br>
known issues in the original GenProg 2012 infrastructure.</p>
<h2 class="code-line" data-line-start=71 data-line-end=72 ><a id="14_Quality_of_the_Documentation_71"></a>1.4 Quality of the Documentation</h2>
<p class="has-line-data" data-line-start="73" data-line-end="78">Section 2 provides step-by-step instructions of reproducing Prophet experiments<br>
with this replication package. Section 3 describes our manual analysis of each<br>
correct Prophet patch. Section 4 describes how to apply Prophet to new defects if<br>
desired. We recommend the user of this replication package starts with the<br>
step-by-step instructions in Section 2.</p>
<h1 class="code-line" data-line-start=79 data-line-end=80 ><a id="2_Reproduce_Prophet_Experiments_79"></a>2. Reproduce Prophet Experiments</h1>
<p class="has-line-data" data-line-start="82" data-line-end="87">In this replication package, we provide VM images of our Amazon EC2 experiment<br>
environment. We evaluated 105 defects/changes in the GenProg 2012 benchmark<br>
set. Due to the disk space limit, we cannot package all of the defects/changes<br>
into the VM images. Instead, we separately provide a scenario tarball for each<br>
defect/change we evaluated in our experiments.</p>
<p class="has-line-data" data-line-start="88" data-line-end="91">We next provide a step by step instructions of running Prophet to generate<br>
patches for the php defect php-309579-309580. Our experiments on other defects<br>
can be reproduced similarly.</p>
<h2 class="code-line" data-line-start=92 data-line-end=93 ><a id="21_StepbyStep_Instruction_of_Reproducing_php309579309580_92"></a>2.1 Step-by-Step Instruction of Reproducing php-309579-309580</h2>
<p class="has-line-data" data-line-start="94" data-line-end="100">(1) Launch VM image<br>
(a) Download VMWare image from:<br>
<a href="http://www.cs.toronto.edu/~fanl/program_repair/vm/Ubuntu-14.04.1-32bit.tar.gz">http://www.cs.toronto.edu/~fanl/program_repair/vm/Ubuntu-14.04.1-32bit.tar.gz</a><br>
(b) Untar the tarball to obtain the VMWare image directory<br>
© Use VMWare to start this image. The login name is ubuntu and the password<br>
is “password”.</p>
<p class="has-line-data" data-line-start="101" data-line-end="103">(2) Go to the directory ~/Workspace/prophet/build/tests.<br>
Type “cd ~/Workspace/prophet/build/tests” in the terminal.</p>
<p class="has-line-data" data-line-start="104" data-line-end="105">(3) Run “…/…/tests/scripts/reproduce.py --prophet php-309579-309580” to reproduce thephp-309579-309580 case with prophet. This case takes approximately 70 minutes to complete.</p>
<p class="has-line-data" data-line-start="106" data-line-end="108">This script automatically downloads the corresponding scenario tarball<br>
from our server (if not downloaded before), untars the tarball and runs Prophet on the defect scenario. For php-309579-309580, the untared directory php-case-2adf58 contains all files of the scenario. 2adf58 is the revision number of the php case from github repository. For some applications, we use different repository systems than the GenProg 2012 paper because old repository systems are often maintained anymore.</p>
<p class="has-line-data" data-line-start="109" data-line-end="110">If you want to reproduce the experiment of running SPR instead of Prophet. Run:</p>
<pre><code>    &quot;../../tests/scripts/reproduce.py php-309579-309580&quot;
</code></pre>
<p class="has-line-data" data-line-start="113" data-line-end="114">If you want to reproduce the experiment of running random algorithm. Run:</p>
<pre><code>    &quot;../../tests/scripts/reproduce.py --random php-309579-309580&quot;
</code></pre>
<p class="has-line-data" data-line-start="117" data-line-end="118">If you want to reproduce the experiment of running the baseline algorithm. Run:</p>
<pre><code>    &quot;../../tests/scripts/reproduce.py --baseline php-309579-309580&quot;
</code></pre>
<p class="has-line-data" data-line-start="121" data-line-end="122">If you want to reproduce the experiment of running Prophet with modification features only. Run:</p>
<pre><code>    &quot;../../tests/scripts/reproduce.py --no-sema php-309579-309580&quot;
</code></pre>
<p class="has-line-data" data-line-start="125" data-line-end="126">If you want to reproduce the experiment of running Prophet with program value features only. Run:</p>
<pre><code>    &quot;../../tests/scripts/reproduce.py --no-mod php-309579-309580&quot;
</code></pre>
<p class="has-line-data" data-line-start="129" data-line-end="131">(4) The produced php-fix-2adf58XXX.c is the generated patch file,<br>
where XXX is the filename of the original source file to be modified.</p>
<p class="has-line-data" data-line-start="132" data-line-end="134">(5) At the end of the script, it will print time information.<br>
The time is used to compute the ``Time’’ column in Figure 11.</p>
<p class="has-line-data" data-line-start="135" data-line-end="139">(6) For the 19 defects that the search space of Prophet/SPR contains at least one correct patch, we manually identify the correct patch in our experiments.<br>
To obtain the position of the correct patches in the search space. We<br>
wrote scripts to dump the Prophet ranked search space and parse the<br>
dumped search space.</p>
<p class="has-line-data" data-line-start="140" data-line-end="141">Run “…/…/tests/scripts/reproduce.py --compare-space --prophet php-309579-309580”. You will see a line like:</p>
<pre><code>Score AAAA Rank XXX/YYY Schema BBBB Ratio ZZZZ
</code></pre>
<p class="has-line-data" data-line-start="144" data-line-end="145">YYY is the total number of candidates in the search space, which corresponds to the “Search Space” column in Figure 12. XXX is the first correct patch rank given by Prophet, which corresponds to “First Correct Patch Rank Prophet” column in Figure 12.</p>
<p class="has-line-data" data-line-start="146" data-line-end="147">You can pass different flags to compute the first correct patch rank of different algorithms as well. For example, “…/…/tests/scripts/reproduce.py --compare-space --no-sema php-309579-309580” correponds to the first correct rank given by Prophet if we trun off the program value features. These numbers are also used to compute the mean rank ratios in Figure 11. Note that we are keep improving the Prophet system, the search space numbers and the running time may be slightly different than the number in the submission.</p>
<p class="has-line-data" data-line-start="148" data-line-end="149">(7) Passing flag “–full-dump” to the script will continously run Prophet (or other systems) exhaustively. For example, “…/…/tests/scripts/reproduce.py --full-dump --prophet php-309579-309580” will run Prophet on php-309579-309580 exhaustively.</p>
<p class="has-line-data" data-line-start="150" data-line-end="155">(8) It is similar to replicate the rest of cases in the benchmark set.<br>
Just replace “php-309579-309580” in the above commands with other case<br>
id. Run “…/…/tests/scripts/reproduce.py” without any argument will<br>
print out all of the case ids. Section 4 of this README contains general<br>
instructions about how to apply Prophet to other applications and defects.</p>
<p class="has-line-data" data-line-start="156" data-line-end="159">(9) All generated fix are checked against all negative and positive test cases by automated scripts. For example, the php-309579-309580 fix is checked<br>
with ~/Workspace/prophet/tools/php-test.py. Inside the <a href="http://php-test.py">php-test.py</a> it invokes<br>
run-test.php. Unlike GenProg, our test script for php checks not only the exit code but also the output of the execution. If you want to manually test the generated fix for php-309579-309580, inside VM you can:</p>
<pre><code>a) Make sure the current directory is ~/Workspace/prophet/build/tests, and you have run the reproduce script in previous steps to generate patches for php-309579-309580.
b) Replace php-case-2adf58/php-2adf58-workdir/src/ext/date/php_date.c with the generated fix file. The name of this fix file is php fix-2adf58ext_date_php_date.c in our example.
  
     &quot;cp php-fix-2adf58ext_date_php_date.c php-case-2adf58/php-2adf58-workdir/src/ext/date/php_date.c&quot;
     
c) &quot;cd php-case-2adf58/php-2adf58-workdir/src&quot; and &quot;make&quot;
d) The newly built php binary sits in:

      &quot;~/Workspace/prophet/build/tests/php-case-2adf58/php-2adf58-workdir/src/sapi/cli/php&quot;
      
To test the negative case, type in:

      &quot;./sapi/cli/php run-tests.php -p ./sapi/cli/php ../tests/03996.phpt&quot;

You should see output indicating that the test case passed. 

In the file ../../php-2adf58.revlog, you will find the ids for the positive
and negative test cases. For php, all cases have a five digit id. Edit the
../../php-2adf58.revlog file and find the id 00051 for positive cases. 

      &quot;./sapi/cli/php run-tests.php -p ./sapi/cli/php ../tests/00051.phpt&quot;

Again, you should see that the tests pass. 
</code></pre>
<p class="has-line-data" data-line-start="184" data-line-end="187">(10) To avoid additional costs, you need to terminate the instance once you<br>
have done with replication. You may also need to delete volumes that used by<br>
the instance after its termination.</p>
<h2 class="code-line" data-line-start=188 data-line-end=189 ><a id="22_fbc_Experiments_188"></a>2.2 fbc Experiments</h2>
<p class="has-line-data" data-line-start="190" data-line-end="193">The instructions above applies also to the fbc experiments. The only difference<br>
is that at the step (1) you need to start the provided 32-bit image instead<br>
of the 64-bit image. For fbc experiments:</p>
<p class="has-line-data" data-line-start="194" data-line-end="200">(1) Launch 32-bit VM image<br>
(a) Download VMWare image from:<br>
<a href="http://XXX/spr-rep/Ubuntu-14.04-32bit.tar">http://XXX/spr-rep/Ubuntu-14.04-32bit.tar</a><br>
(b) Untar the tarball to obtain the VMWare image directory<br>
© Use VMWare to start this image. The login name is fanl and the password<br>
is “password”.</p>
<p class="has-line-data" data-line-start="201" data-line-end="203">(2)-(10) Same as the instructions in Section 2.1. There are three fbc cases<br>
“fbc-5251-5252”, “fbc-5458-5459”, and “fbc-5556-5557”.</p>
<h2 class="code-line" data-line-start=204 data-line-end=205 ><a id="23_Training_204"></a>2.3 Training</h2>
<p class="has-line-data" data-line-start="206" data-line-end="208">The above experiments operate with already trained model, whose parameters are specified in “~/Workspace/prophet/crawler/” with file names “para-XXX.out” or “para-YYY-XXX.out”. XXX corresponds to application that is excluded from the<br>
training phase. YYY corresponds to the special configurations such as no program value features (no-sema) or no modification features (no-mod).</p>
<p class="has-line-data" data-line-start="209" data-line-end="210">We providied scripts to reproduce the training phase as well. You can follow the following instructions to rerun the training phase:</p>
<p class="has-line-data" data-line-start="211" data-line-end="215">(1) Launch the 64-bit VM image.<br>
(2) “cd ~/Workspace/prophet/crawler”<br>
(3) Run “./learn.py”. It will rerun all feature extraction and training steps and generate “para-all.out”, “para-php.out”, etc… It takes approximately 30 minutes.<br>
(4) You can also run “./learn.py --no-mod” or “./learn.py --no-sema” to generate parameter files with special configurations (no program value features or no modification features).</p>
<h2 class="code-line" data-line-start=216 data-line-end=217 ><a id="24_Known_issues_216"></a>2.4 Known issues</h2>
<p class="has-line-data" data-line-start="218" data-line-end="223">The current Prophet/SPR implementation fails to run on six cases in the GenProg<br>
2012 benchmark set: php-308046-308051, libtiff-ed4969a-8a184dc,<br>
python-69831-69833, wireshark-35419-35414, wireshark-37171-37170, and<br>
wireshark-37190-37191. Note that we report that Prophet and SPR generate no<br>
patch for these defects in our paper.</p>
<p class="has-line-data" data-line-start="224" data-line-end="232">The plausible (but incorrect) patch Prophet generates for python-70019-70023 is<br>
compiler dependent and possibly machine dependent. The patch attempts to get<br>
around the test case via messing with memory library calls. Its behavior is<br>
therefore highly dependent on the underlying implementation of the memory<br>
routine it links to. It is known that the binary generated during Prophet<br>
repair process can pass the test case in Amazon EC2 (via clang compiler);<br>
however, the binary generated by gcc compiler cannot pass the test case. Thanks<br>
to Alex Zhikhartsev for reporting this.</p>
<h1 class="code-line" data-line-start=233 data-line-end=234 ><a id="3_Prophet_Correct_Patches_233"></a>3. Prophet Correct Patches</h1>
<p class="has-line-data" data-line-start="235" data-line-end="239">Prophet generates correct patches for 15 defects. For each defect, we provide<br>
an url that contains the developer patch and we either identifies the Prophet<br>
patch is semantically equivalent to the developer patch or provides a brief<br>
analysis for why the Prophet patch is correct.</p>
<ol>
<li class="has-line-data" data-line-start="240" data-line-end="247">
<p class="has-line-data" data-line-start="240" data-line-end="241">php-307562-307561</p>
<p class="has-line-data" data-line-start="242" data-line-end="246">The developer patch:<br>
<a href="https://github.com/php/php-src/commit/f455f8">https://github.com/php/php-src/commit/f455f8</a><br>
The Prophet correct patches:<br>
<a href="http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-307562-307561/php-fix-f455f8%5e1-f455f8ext_dom_document.c">http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-307562-307561/php-fix-f455f8^1-f455f8ext_dom_document.c</a></p>
</li>
</ol>
<p class="has-line-data" data-line-start="247" data-line-end="251">Analysis:<br>
The Prophet generated patch is identical to the developer patch. Note that this is<br>
a regression that occurs in the repository. The reference correct revision<br>
occurs before the buggy revision.</p>
<ol start="2">
<li class="has-line-data" data-line-start="252" data-line-end="259">
<p class="has-line-data" data-line-start="252" data-line-end="253">php-307846-307853</p>
<p class="has-line-data" data-line-start="254" data-line-end="258">The developer patch:<br>
<a href="https://github.com/php/php-src/commit/1e91069">https://github.com/php/php-src/commit/1e91069</a><br>
The Prophet correct patches:<br>
<a href="http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-307846-307853/php-fix-1e91069ext_date_php_date.c">http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-307846-307853/php-fix-1e91069ext_date_php_date.c</a></p>
</li>
</ol>
<p class="has-line-data" data-line-start="259" data-line-end="261">Analysis:<br>
The Prophet generated patch is identical to the developer patch.</p>
<ol start="3">
<li class="has-line-data" data-line-start="262" data-line-end="269">
<p class="has-line-data" data-line-start="262" data-line-end="263">php-308734-308761</p>
<p class="has-line-data" data-line-start="264" data-line-end="268">The developer patch:<br>
<a href="https://github.com/php/php-src/commit/1d984a7">https://github.com/php/php-src/commit/1d984a7</a><br>
The Prophet correct patches:<br>
<a href="http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-308734-308761/php-fix-1d984a7ext_tokenizer_tokenizer.c">http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-308734-308761/php-fix-1d984a7ext_tokenizer_tokenizer.c</a></p>
</li>
</ol>
<p class="has-line-data" data-line-start="269" data-line-end="273">Analysis:<br>
The statement order of the developer patch is slightly different from that of<br>
the Prophet generated patch, but two patches are semantically equivalent at high<br>
level.</p>
<ol start="4">
<li class="has-line-data" data-line-start="274" data-line-end="281">
<p class="has-line-data" data-line-start="274" data-line-end="275">php-309516-309535</p>
<p class="has-line-data" data-line-start="276" data-line-end="280">The developer patch:<br>
<a href="https://github.com/php/php-src/commit/991ba131">https://github.com/php/php-src/commit/991ba131</a><br>
The Prophet correct patches:<br>
<a href="http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-309516-309535/php-fix-991ba131ext_date_php_date.c">http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-309516-309535/php-fix-991ba131ext_date_php_date.c</a></p>
</li>
</ol>
<p class="has-line-data" data-line-start="281" data-line-end="283">Analysis:<br>
The Prophet generated patch is identical to the developer patch.</p>
<ol start="5">
<li class="has-line-data" data-line-start="284" data-line-end="291">
<p class="has-line-data" data-line-start="284" data-line-end="285">php-309579-309580</p>
<p class="has-line-data" data-line-start="286" data-line-end="290">The developer patch:<br>
<a href="https://github.com/php/php-src/commit/2adf58c">https://github.com/php/php-src/commit/2adf58c</a><br>
The Prophet correct patches:<br>
<a href="http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-309579-309580/php-fix-2adf58ext_date_php_date.c">http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-309579-309580/php-fix-2adf58ext_date_php_date.c</a></p>
</li>
</ol>
<p class="has-line-data" data-line-start="291" data-line-end="293">Analysis:<br>
The Prophet generated patch is semantically equivalent to the developer patch, because when isostr == 0, isostr_len is always 0 at the modified program point.</p>
<ol start="6">
<li class="has-line-data" data-line-start="295" data-line-end="302">
<p class="has-line-data" data-line-start="295" data-line-end="296">php-309892-309910</p>
<p class="has-line-data" data-line-start="297" data-line-end="301">The developer patch:<br>
<a href="https://github.com/php/php-src/commit/5a8c917">https://github.com/php/php-src/commit/5a8c917</a><br>
The Prophet correct patches:<br>
<a href="http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-309892-309910/php-fix-5a8c917ext_standard_string.c">http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-309892-309910/php-fix-5a8c917ext_standard_string.c</a></p>
</li>
</ol>
<p class="has-line-data" data-line-start="302" data-line-end="307">Analysis:<br>
The developer patch removes an if statement block. The Prophet generated patch<br>
conjoins the branch condition of the if statement with 0, which effectively<br>
nullifies the whole if statement block. Two patches are semantically<br>
equivalent.</p>
<ol start="7">
<li class="has-line-data" data-line-start="308" data-line-end="315">
<p class="has-line-data" data-line-start="308" data-line-end="309">php-310991-310999</p>
<p class="has-line-data" data-line-start="310" data-line-end="314">The developer patch:<br>
<a href="https://github.com/php/php-src/commit/8ba00176">https://github.com/php/php-src/commit/8ba00176</a><br>
The Prophet correct patches:<br>
<a href="http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-310991-310999/php-fix-8ba00176Zend_zend_compile.c">http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-310991-310999/php-fix-8ba00176Zend_zend_compile.c</a></p>
</li>
</ol>
<p class="has-line-data" data-line-start="315" data-line-end="318">Analysis:<br>
The developer patch changes an if statement condition from (A || (B &amp;&amp; C)) to<br>
((A || B) &amp;&amp; C). The Prophet patch changes the condition to ((A || (B &amp;&amp; C)) &amp;&amp; C), which is semantically equivalent to the developer patch.</p>
<ol start="8">
<li class="has-line-data" data-line-start="319" data-line-end="326">
<p class="has-line-data" data-line-start="319" data-line-end="320">php-311346-311348</p>
<p class="has-line-data" data-line-start="321" data-line-end="325">The developer patch:<br>
<a href="https://github.com/php/php-src/commit/1056c57f">https://github.com/php/php-src/commit/1056c57f</a><br>
The Prophet correct patches:<br>
<a href="http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-311346-311348/php-fix-1056c57fext_standard_url_scanner_ex.c">http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-311346-311348/php-fix-1056c57fext_standard_url_scanner_ex.c</a></p>
</li>
</ol>
<p class="has-line-data" data-line-start="326" data-line-end="334">Analysis:<br>
The functionality of the developer patched code is that if “ctx-&gt;buf.len”<br>
(which holds the length of “ctx-&gt;buf”) is not zero, then “handled_output” is<br>
assigned as the concatenation of “ctx-&gt;buf” and “output”; otherwise<br>
“handled_output” is assigned as the “output”. When “ctx-&gt;buf.len” is zero, the<br>
code in the then branch has the same effect as the else branch since the string<br>
“ctx-&gt;buf” is empty. So the Prophet patch, which eliminates the condition and lets<br>
the program always do the then branch, is also correct.</p>
<ol start="9">
<li class="has-line-data" data-line-start="335" data-line-end="342">
<p class="has-line-data" data-line-start="335" data-line-end="336">libtiff-ee2ce5b7-b5691a5a</p>
<p class="has-line-data" data-line-start="337" data-line-end="341">The developer patch:<br>
<a href="https://github.com/vadz/libtiff/commit/eec7ec0">https://github.com/vadz/libtiff/commit/eec7ec0</a><br>
The Prophet correct patches:<br>
<a href="http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/libtiff-ee2ce5b7-b5691a5a/libtiff-fix-tests-eec7ec0tools_tiff2pdf.c">http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/libtiff-ee2ce5b7-b5691a5a/libtiff-fix-tests-eec7ec0tools_tiff2pdf.c</a></p>
</li>
</ol>
<p class="has-line-data" data-line-start="342" data-line-end="344">Analysis:<br>
The Prophet patch is identical to the developer patch.</p>
<ol start="10">
<li class="has-line-data" data-line-start="345" data-line-end="352">
<p class="has-line-data" data-line-start="345" data-line-end="346">gmp-13420-13421</p>
<p class="has-line-data" data-line-start="347" data-line-end="351">The developer patch:<br>
<a href="https://gmplib.org/repo/gmp/rev/131005cc271b">https://gmplib.org/repo/gmp/rev/131005cc271b</a><br>
The Prophet correct patches:<br>
<a href="http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/gmp-13420-13421/gmp-fix-13421mpn_generic_powm.c">http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/gmp-13420-13421/gmp-fix-13421mpn_generic_powm.c</a></p>
</li>
</ol>
<p class="has-line-data" data-line-start="352" data-line-end="355">Analysis:<br>
The developer patch removes the variable “b2p” and the assignment statement<br>
“b2p = tp + 2 * n”. It then replaces every occurrence or “b2p” to “rp”. The Prophet patch simply changes the assignment “b2p = tp + 2 * n” to “b2p = rp”, which is semantically equivalent to the developer patch at high level.</p>
<ol start="11">
<li class="has-line-data" data-line-start="356" data-line-end="363">
<p class="has-line-data" data-line-start="356" data-line-end="357">gzip-a1d3d4019d-f17cbd13a1</p>
<p class="has-line-data" data-line-start="358" data-line-end="362">The developer patch:<br>
<a href="http://git.savannah.gnu.org/cgit/gzip.git/commit/?id=f17cbd13a1d0a7">http://git.savannah.gnu.org/cgit/gzip.git/commit/?id=f17cbd13a1d0a7</a><br>
The Prophet correct patches:<br>
<a href="http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/gzip-a1d3d4019d-f17cbd13a1/gzip-fix-f17cbd13a1d0a7gzip.c">http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/gzip-a1d3d4019d-f17cbd13a1/gzip-fix-f17cbd13a1d0a7gzip.c</a></p>
</li>
</ol>
<p class="has-line-data" data-line-start="363" data-line-end="367">Analysis:<br>
Both the developer patch and the Prophet patch inserts an assignment statement to<br>
initialize the variable “ifd” to 0. Two patches are semantically equivalent at<br>
high level.</p>
<ol start="12">
<li class="has-line-data" data-line-start="368" data-line-end="375">
<p class="has-line-data" data-line-start="368" data-line-end="369">php-307914-307915</p>
<p class="has-line-data" data-line-start="370" data-line-end="374">The developer patch:<br>
<a href="https://github.com/php/php-src/commit/09273098521913a">https://github.com/php/php-src/commit/09273098521913a</a><br>
The Prophet correct patches:<br>
<a href="http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-307914-307915/php-fix-09273098521913aext_phar_phar.c">http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-307914-307915/php-fix-09273098521913aext_phar_phar.c</a></p>
</li>
</ol>
<p class="has-line-data" data-line-start="375" data-line-end="377">Analysis:<br>
The developer patch and the Prophet patch are identical.</p>
<ol start="13">
<li class="has-line-data" data-line-start="378" data-line-end="385">
<p class="has-line-data" data-line-start="378" data-line-end="379">php-308262-308315</p>
<p class="has-line-data" data-line-start="380" data-line-end="384">The developer patch:<br>
<a href="https://github.com/php/php-src/commit/b84967d">https://github.com/php/php-src/commit/b84967d</a><br>
The Prophet correct patches:<br>
<a href="http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-308262-308315/php-fix-b84967dZend_zend_execute.c">http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-308262-308315/php-fix-b84967dZend_zend_execute.c</a></p>
</li>
</ol>
<p class="has-line-data" data-line-start="385" data-line-end="387">Analysis:<br>
The developer patch and the Prophet patch are identical.</p>
<ol start="14">
<li class="has-line-data" data-line-start="388" data-line-end="395">
<p class="has-line-data" data-line-start="388" data-line-end="389">fbc-5458-5459</p>
<p class="has-line-data" data-line-start="390" data-line-end="394">The developer patch:<br>
<a href="http://fbc.svn.sourceforge.net/viewvc/fbc/trunk/FreeBASIC/src/rtlib/libfb_str_midassign.c?r1=5459&amp;r2=5458&amp;pathrev=5459">http://fbc.svn.sourceforge.net/viewvc/fbc/trunk/FreeBASIC/src/rtlib/libfb_str_midassign.c?r1=5459&amp;r2=5458&amp;pathrev=5459</a><br>
The Prophet correct patches:<br>
<a href="http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/fbc-5458-5459/fbc-fix-5459fbc-src_src_rtlib_libfb_str_midassign.c">http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/fbc-5458-5459/fbc-fix-5459fbc-src_src_rtlib_libfb_str_midassign.c</a></p>
</li>
</ol>
<p class="has-line-data" data-line-start="395" data-line-end="397">Analysis:<br>
Although the developer patch changed (len &lt; 1) to (len &lt; 0), “len” will never be zero inside the if block after the patch. Therefore two patches are semantically equivalent.</p>
<ol start="15">
<li class="has-line-data" data-line-start="398" data-line-end="405">
<p class="has-line-data" data-line-start="398" data-line-end="399">libtiff-d13be72c-ccadf48a</p>
<p class="has-line-data" data-line-start="400" data-line-end="404">The developer patch:<br>
<a href="https://github.com/vadz/libtiff/commit/3edb9cd">https://github.com/vadz/libtiff/commit/3edb9cd</a><br>
The Prophet correct patches:<br>
<a href="http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/libtiff-d13be72c-ccadf48a/libtiff-fix-tests2-3edb9cdlibtiff_tif_dirread.c">http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/libtiff-d13be72c-ccadf48a/libtiff-fix-tests2-3edb9cdlibtiff_tif_dirread.c</a></p>
</li>
</ol>
<p class="has-line-data" data-line-start="405" data-line-end="407">Analysis:<br>
The developer patch changes (td-&gt;td_nstrips &gt; 1) to (td-&gt;td_nstrips &gt; 2), while the Prophet patch appends an additional clause (&amp;&amp; td-&gt;td_nstrips != 2). Two patches are equivalent.</p>
<h2 class="code-line" data-line-start=408 data-line-end=409 ><a id="31_Other_correct_patches_in_space_408"></a>3.1 Other correct patches in space</h2>
<p class="has-line-data" data-line-start="410" data-line-end="411">There are other four defects for which the correct patches are inside the search space.</p>
<p class="has-line-data" data-line-start="412" data-line-end="413">a) php-309688-309716: <a href="https://github.com/php/php-src/commit/3acdca">https://github.com/php/php-src/commit/3acdca</a></p>
<p class="has-line-data" data-line-start="414" data-line-end="415">b) php-310011-310050: <a href="https://github.com/php/php-src/commit/efcb9a71">https://github.com/php/php-src/commit/efcb9a71</a></p>
<p class="has-line-data" data-line-start="416" data-line-end="417">c) php-309111-309159: <a href="https://github.com/php/php-src/commit/ee83270">https://github.com/php/php-src/commit/ee83270</a></p>
<p class="has-line-data" data-line-start="418" data-line-end="419">For this defect, the correct patch in space is:</p>
<p class="has-line-data" data-line-start="420" data-line-end="421"><a href="http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-309111-309159/php-fix-ee83270ext_standard_url.c-8">http://www.cs.toronto.edu/~fanl/program_repair/prophet-rep/prophet-result/php-309111-309159/php-fix-ee83270ext_standard_url.c-8</a></p>
<p class="has-line-data" data-line-start="422" data-line-end="423">d) libtiff-5b02179-3dfb33b: <a href="https://github.com/vadz/libtiff/commit/2e42d63f">https://github.com/vadz/libtiff/commit/2e42d63f</a></p>
<h1 class="code-line" data-line-start=424 data-line-end=425 ><a id="4_How_to_Run_Prophet_in_New_Environments_New_ApplicationsDefects_424"></a>4. How to Run Prophet in New Environments? (New Applications/Defects)</h1>
<p class="has-line-data" data-line-start="426" data-line-end="431">Defects often require specific environments to reproduce. We strongly recommend<br>
any user of this replication package to reproduce our experiments via provided<br>
VM images with the above instructions. However, Prophet is able to apply<br>
to other UNIX like environments, other applications, and other defects. Here<br>
are general instructions about how to do so:</p>
<ol start="0">
<li class="has-line-data" data-line-start="432" data-line-end="435">
<p class="has-line-data" data-line-start="432" data-line-end="434">The application needs to be able to build with both gcc and clang. Prophet uses<br>
clang to run its error localization algorithm. It requires llvm and clang 3.6.2.</p>
</li>
<li class="has-line-data" data-line-start="435" data-line-end="439">
<p class="has-line-data" data-line-start="435" data-line-end="438">Write a script that builds the application. See, for example,<br>
~/Workspace/prophet/tools/fbc-build.py in the Prophet VM image is the script for<br>
building fbc.</p>
</li>
<li class="has-line-data" data-line-start="439" data-line-end="444">
<p class="has-line-data" data-line-start="439" data-line-end="443">Write another script that tests the application. See, for example,<br>
~/Workspace/prophet/tools/fbc-test.py in the Prophet VM. The script takes the<br>
built src directory, the testcase directory if any, and a set of testcase ids.<br>
It outputs the list of passed testcase ids.</p>
</li>
<li class="has-line-data" data-line-start="444" data-line-end="450">
<p class="has-line-data" data-line-start="444" data-line-end="449">Write or generate a log file that specifies the testcase ids of the positive<br>
testcase set and the testcase ids of the negative testcase set. See, for<br>
example, if you untar the scenario fbc-5458-5459 (fbc-5459.tar.gz), you can<br>
find the log file for the scenario at<br>
~/Workspace/prophet/build/tests/fbc-case-5459/fbc-5459.revlog in Prophet 32-bit VM.</p>
</li>
<li class="has-line-data" data-line-start="450" data-line-end="458">
<p class="has-line-data" data-line-start="450" data-line-end="451">Write a configuration file that specifies:</p>
<p class="has-line-data" data-line-start="452" data-line-end="457">a) the location of the scripts<br>
b) the source location of the application<br>
c) the location of the test cases<br>
d) the location of the log file that specifies negative and positive testcases<br>
e) add a line “localizer=profile” to enable error localizer</p>
</li>
</ol>
<p class="has-line-data" data-line-start="458" data-line-end="459">See, for example, if you untar the scenario fbc-5458-5459 (fbc-5459.tar.gz), you can find the configuration file of the scenario at: ~/Workspace/prophet/build/tests/fbc-case-5459/fbc-5459.conf in Prophet 32-bit VM.</p>
<ol start="5">
<li class="has-line-data" data-line-start="460" data-line-end="464">
<p class="has-line-data" data-line-start="460" data-line-end="461">Invoke Prophet with the configuration file: for example, you can call:</p>
<p class="has-line-data" data-line-start="462" data-line-end="463">…/src/prophet -feature-para …/…/crawler/para-all.out ~/Workspace/prophet/build/tests/fbc-case-5459/fbc-5459.conf -first-n-loc 200 -consider-all</p>
</li>
</ol>
<p class="has-line-data" data-line-start="464" data-line-end="465">to run Prophet. Note that “-feature-para …/…/crawler/para-all.out” specifies the file (&quot;…/…/crawler/para-all.out&quot;) that contains learned feature parameter of the model.</p>
<p class="has-line-data" data-line-start="466" data-line-end="469">When you run it in this way, Prophet will create a temporary workdir. You can<br>
specify the workdir name and make the workdir permanent.<br>
You can run initialization step first by invoking:</p>
<pre><code>../src/prophet ~/Workspace/prophet/build/tests/fbc-case-5459/fbc-5459.conf -r workdir -init-only
</code></pre>
<p class="has-line-data" data-line-start="472" data-line-end="473">Prophet will create a directory called “workdir” to hold all results after initialization.</p>
<p class="has-line-data" data-line-start="474" data-line-end="475">Then after initialization you can call</p>
<pre><code>../src/prophet -feature-para ../../crawler/para-all.out -r workdir -skip-verify -first-n-loc 200 -consider-all
</code></pre>
<p class="has-line-data" data-line-start="478" data-line-end="479">to run Prophet.</p>
<pre><code>a) skip-verify flag tells Prophet to skip initialization step 
b) first-n-loc and consider-all flags tell Prophet to consider all source files and modify the first 200 statements returned by the error localization.
</code></pre>
<p class="has-line-data" data-line-start="483" data-line-end="485">The benefit of having a working directory is that you can avoid running error<br>
localization algorithm and testcase verification again.</p>

</body></html>